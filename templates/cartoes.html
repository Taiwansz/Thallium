{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="content-card">
            <h2 class="text-center mb-4">Meus Cartões</h2>

            {% if cartoes %}
            <div class="row">
                {% for cartao in cartoes %}
                <div class="col-md-6 mb-4">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front card bg-dark text-white p-3" style="border-radius: 15px; min-height: 200px;">
                                <div class="d-flex justify-content-between">
                                    <i class="fas fa-wifi"></i>
                                    <i class="fab fa-cc-mastercard fa-2x"></i>
                                </div>
                                <div class="mt-4">
                                    <h5 class="mb-0" style="letter-spacing: 2px;">{{ cartao.numero[:4] }} **** **** {{ cartao.numero[-4:] }}</h5>
                                </div>
                                <div class="d-flex justify-content-between mt-4 align-items-end">
                                    <div>
                                        <small>Titular</small><br>
                                        <span>{{ current_user.nome.split()[0] | upper }}</span>
                                    </div>
                                    <div>
                                        <small>Validade</small><br>
                                        <span>{{ cartao.validade }}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flip-card-back card bg-secondary text-white p-3" style="border-radius: 15px; min-height: 200px; transform: rotateY(180deg);">
                                <div class="mt-2" style="background: #000; height: 40px; width: 100%;"></div>
                                <div class="mt-3 text-right pr-3">
                                    <small>CVV</small><br>
                                    <span class="bg-white text-dark px-2 py-1 font-weight-bold">{{ cartao.cvv }}</span>
                                </div>
                                <div class="mt-4 text-center">
                                    <i class="fab fa-cc-mastercard fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mt-2">
                        {% if cartao.bloqueado %}
                        <form action="{{ url_for('desbloquear_cartao', id_cartao=cartao.id) }}" method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-warning btn-sm btn-block"><i class="fas fa-lock"></i> Desbloquear</button>
                        </form>
                        {% else %}
                        <form action="{{ url_for('bloquear_cartao', id_cartao=cartao.id) }}" method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-outline-danger btn-sm btn-block"><i class="fas fa-unlock"></i> Bloquear</button>
                        </form>
                        {% endif %}
                    </div>

                </div>
                {% endfor %}
            </div>
            {% else %}
                <p class="text-center text-muted">Nenhum cartão encontrado.</p>
            {% endif %}

            <div class="text-center mt-3">
                 <a href="{{ url_for('index') }}" class="btn btn-secondary">Voltar</a>
            </div>
        </div>
    </div>
</div>

<style>
/* Flip Card Styles */
.flip-card {
  background-color: transparent;
  width: 100%;
  height: 200px;
  perspective: 1000px;
}

.flip-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.flip-card:hover .flip-card-inner {
  transform: rotateY(180deg);
}

.flip-card-front, .flip-card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  border-radius: 15px;
}

.flip-card-back {
  transform: rotateY(180deg);
}
</style>
{% endblock %}
